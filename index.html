<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>產出全台股清單</title></head>
<body>
    <h2>正在從證交所資料來源產出全台股 list.js...</h2>
    <p>請稍候，完成後會自動彈出下載視窗。</p>
    <script>
        async function build() {
            try {
                // 這是證交所公開的 JSON 資料來源，比爬網頁更穩定
                const res = await fetch('https://raw.githubusercontent.com/finmind/FinMind/master/FinMind/Data/TaiwanStockInfo.json');
                const data = await res.json();
                
                // 整理格式：排除非股票類，僅保留代號名稱
                let listContent = "const twStockData = [\n";
                const stocks = data.filter(s => s.stock_id.length <= 5); // 過濾掉過長的權證
                
                stocks.forEach((s, i) => {
                    listContent += `    {c:"${s.stock_id}", n:"${s.stock_name}"}${i === stocks.length - 1 ? "" : ",\n"}`;
                });
                listContent += "\n];";

                // 強制下載
                const blob = new Blob([listContent], { type: 'text/javascript' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'list.js';
                a.click();
                document.body.innerHTML = "<h1>✅ 完成！</h1><p>請將下載的 <b>list.js</b> 放到你的看板資料夾。現在打『味』或『十』都會秒出了！</p>";
            } catch (e) {
                document.body.innerHTML = "<h1>❌ 錯誤</h1><p>請確認網路連線。若仍失敗，請直接告訴我，我用分段方式貼給你。</p>";
            }
        }
        build();
    </script>
</body>
</html>
